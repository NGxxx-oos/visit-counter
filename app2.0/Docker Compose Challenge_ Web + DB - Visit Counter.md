# Docker Compose Challenge: Web + DB - Visit Counter

## Описание проекта

Этот проект реализует простой сервис "счетчик посещений" в виде связки веб-приложения и базы данных PostgreSQL, оркестрированных с помощью Docker Compose.

**Веб-приложение** (написано на Python с использованием FastAPI) при каждом GET-запросе на корневой URL (`/`) выполняет следующие действия:
1. Подключается к базе данных PostgreSQL.
2. Создает таблицу `visits`, если она еще не существует.
3. Вставляет новую запись с текущим временем.
4. Возвращает общее количество записей в таблице.

## Технические требования и их реализация

| Требование | Реализация |
| :--- | :--- |
| **Приложение** | Python (FastAPI), слушает порт 8000. |
| **Контейнеризация** | Оптимизированный многоступенчатый `Dockerfile` на базе `python:3.11-slim`. |
| **Оркестрация** | `docker-compose.yml` с двумя сервисами: `app` и `db`. |
| **Networking** | Приложение обращается к БД по имени сервиса: `DB_HOST: db`. |
| **Security** | Все учетные данные БД передаются через переменные окружения в `docker-compose.yml`. |
| **Persistence** | Данные PostgreSQL сохраняются в именованный Docker Volume (`postgres_data`). |

## Запуск проекта

Для запуска проекта убедитесь, что у вас установлен Docker и Docker Compose.

### Команда для запуска

Проект будет запущен в фоновом режиме (`-d`).

```bash
docker-compose up -d
```

### Проверка работоспособности

После запуска дайте сервисам несколько секунд на инициализацию. Затем выполните несколько запросов к веб-приложению (по умолчанию доступно на порту 8000):

**Первый визит:**
```bash
curl http://localhost:8000
```
Ожидаемый вывод:
```
{"message":"Hello! I have been visited 1 times"}
```

**Второй визит:**
```bash
curl http://localhost:8000
```
Ожидаемый вывод:
```
{"message":"Hello! I have been visited 2 times"}
```

### Проверка персистентности данных

Чтобы убедиться, что данные сохраняются в томе:

1. **Остановите и удалите контейнеры:**
   ```bash
   docker-compose down
   ```
2. **Запустите контейнеры снова:**
   ```bash
   docker-compose up -d
   ```
3. **Выполните запрос:**
   ```bash
   curl http://localhost:8000
   ```
   Ожидаемый вывод:
   ```
   {"message":"Hello! I have been visited 3 times"}
   ```
   (Счетчик должен продолжить отсчет с 3, а не с 1.)

## Структура проекта

```
.
├── app/
│   └── main.py           # Исходный код веб-приложения (FastAPI)
├── Dockerfile            # Оптимизированный Dockerfile для приложения
├── docker-compose.yml    # Файл оркестрации
├── requirements.txt      # Зависимости Python
└── README.md             # Этот файл
```
